<?php
use UmutPHP\WPVulnerabilityCheck;
class ManagerTest extends PHPUnit_Framework_TestCase
{
    private $manager;

    public function __construct()
    {
        $this->manager = new WPVulnerabilityCheck\Manager();
    }

    public function testCheckVulnerabilityWithVersion()
    {
        $array = array(
            'vulnerabilities' => array(
                array(
                    'fixed_in' => 1
                ),
                array(
                    'fixed_in' => 3
                )
            )
        );

        $result = $this->manager->checkVulnerabilityWithVersion($array, 2);

        $this->assertEquals(1, count($result['vulnerabilities']));
        $this->assertTrue(isset($result['vulnerabilities'][1]));
        $this->assertFalse(isset($result['vulnerabilities'][0]));
    }

    public function testIsComponent() {
        $settings = new WPVulnerabilityCheck\Settings();
        $manager  = new WPVulnerabilityCheck\Manager($settings);

        $this->assertTrue($manager->isComponent('plugin.php'));        
        $this->assertFalse($manager->isComponent('index.php'));        
        $this->assertFalse($manager->isComponent('..'));        
        $this->assertFalse($manager->isComponent('.'));        
    }

    public function testIsComponentWithExcluded() {
        $settings = new WPVulnerabilityCheck\Settings();
        $settings->excluded = array("plugin1", "plugin2");
        $manager  = new WPVulnerabilityCheck\Manager($settings);

        $this->assertTrue($manager->isComponent('plugin.php'));        
        $this->assertFalse($manager->isComponent('index.php'));        
        $this->assertFalse($manager->isComponent('plugin1'));        
        $this->assertFalse($manager->isComponent('plugin2'));        
        $this->assertFalse($manager->isComponent('..'));        
        $this->assertFalse($manager->isComponent('.'));        
    }
}
