<?php
namespace UmutPHP\WPVulnerabilityCheck;
/**
 * Abstract class for output generation
 */
class OutputColored extends Output
{
    private $color;
    /**
     * @param Writer\Writer $writer
     */
    public function __construct(Writer\Writer $writer = null)
    {
        $this->writer = $writer ?: new Writer\Readable;
        $this->color  = new Colors();
    }

    public function ok()
    {
        $this->writer->write($this->color->getColoredString('.', 'green'));
        $this->progress();
    }

    public function error()
    {
        $this->writer->write($this->color->getColoredString('V', 'red'));
        $this->progress();
    }

    public function fail()
    {
        $this->writer->write($this->color->getColoredString('-', 'yellow'));
        $this->progress();
    }

    protected function progress()
    {
        if (++$this->checkedPlugins % $this->pluginsPerLine === 0) {
            if ($this->totalPluginCount != 0) { // !=
                $percent = round($this->checkedPlugins / $this->totalPluginCount * 100);
                $current = $this->stringWidth($this->checkedPlugins, strlen($this->totalPluginCount));
                $this->writeLine(
                    $this->color->getColoredString(" $current/$this->totalPluginCount ($percent %)", "blue")
                );
            }
        }
    }
}
